<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="JudaMap">

	<!-- ===== 로그인/회원가입 ===== -->

	<!-- 로그인 -->
	<select id="selectLogin" parameterType="LoginVO" resultType="Integer">
		SELECT 	count(*)
		FROM 	Member
		WHERE 	member_id = #{member_id} AND password = #{password}
	</select>
	
	<!-- 회원가입 -->
	<select id="checkId" parameterType="LoginVO" resultType="Integer">
		SELECT 	count(*)
		FROM 	Member
		WHERE 	member_id = #{member_id}
	</select>
		<!-- 아이디 중복 확인 -->
	<insert id="insertMember" parameterType="MemberVO">
		INSERT INTO Member (member_id, password, name, gender, tel, email, birth, signin_date, agree_email, agree_sns) 
		VALUES (#{member_id}, #{password}, #{name}, #{gender}, #{tel}, #{email}, #{birth}, sysdate, #{agree_email}, #{agree_sns})
	</insert>
	
<!-- =================================================================================== -->

	<!-- ===== 상품목록 페이지 ===== -->
	
	<!-- 상품목록 띄우기 -->
	<select id="getGoodsList" parameterType="GoodsTypeVO" resultType="GoodsVO">
		SELECT * FROM Goods
		<if test="goods_type!='전체'">
		WHERE goods_type = #{goods_type}
		</if>
		ORDER BY ${goods_sort}
	</select>

	<!-- 상품상세 띄우기 -->
	<select id="getGoods" parameterType="String" resultType="GoodsVO">
		SELECT * FROM Goods where goods_id = #{goods_id}
	</select>
	
<!-- =================================================================================== -->

	<!-- ===== 상품 페이지 ===== -->
	
	<!-- 같은 상품을 또 넣을지 확인 -->
	<select id="checkCart" parameterType="CartRowVO" resultType="String">
		SELECT count(*)
		FROM Cart
		WHERE member_id = #{member_id} AND goods_id = #{goods_id}
	</select>

	<!-- 장바구니에 넣기  -->
	<insert id="insertCart" parameterType="CartRowVO">
		INSERT INTO Cart
		VALUES (seq_cart.nextval, #{member_id}, #{goods_id}, #{c_amount})
	</insert>
	
	<!-- 장바구니의 상품의 수량만 바꾸기 -->
	<update id="updateCart" parameterType="CartRowVO">
		UPDATE Cart
		SET c_amount = c_amount + #{c_amount}
		WHERE member_id = #{member_id} AND goods_id = #{goods_id}
	</update>
	
	<!-- 장바구니를 띄울 때 필요한 정보 가져오기 -->
	<select id="getCart" parameterType="String" resultType="CartVO">
		SELECT c.C_AMOUNT AS C_AMOUNT, g.goods_id goods_id, g.GOODS_NAME GOODS_NAME, g.IMG_FILE IMG_FILE, g.PRICE PRICE, g.DELIVERY_CHARGE DELIVERY_CHARGE
		FROM Cart c INNER JOIN GOODS g 		ON c.GOODS_ID = g.GOODS_ID
					INNER JOIN "MEMBER" m 	ON c.MEMBER_ID = m.MEMBER_ID
		WHERE m.MEMBER_ID = #{member_id}
	</select>
	
<!-- =================================================================================== -->

	<!-- ===== 장바구니 ===== -->
	
	<!-- 장바구니 행 삭제 -->
	<delete id="deleteCart" parameterType="CartRowVO">
		DELETE FROM Cart 
		WHERE member_id = #{member_id} AND goods_id = #{goods_id}
	</delete>

	
	<insert id="insertDelivery" parameterType="PayVO">
		INSERT INTO DELIVERY
		VALUES (delivery_seq.nextval, #{delivery_name}, #{receiver}, #{delivery_tel}, #{postcode}, #{addr},
			#{addr_detail}, #{delivery_memo})
   </insert>
   
   
   <insert id="insertOrderList" parameterType="PayVO">
      INSERT INTO ORDERLIST
      VALUES (orderlist_seq.nextval, '결제완료', sysdate, #{o_sum}, #{member_id})
   </insert>
	

</mapper>